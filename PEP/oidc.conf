# Configuration OIDC simplifiée - endpoints manuels seulement
OIDCClientID flask-app
OIDCClientSecret flask-app-secret
OIDCRedirectURI http://localhost:5000/oauth2callback

# Configuration manuelle des endpoints (pas de métadonnées automatiques)
OIDCProviderIssuer http://localhost
OIDCProviderAuthorizationEndpoint http://localhost/auth
OIDCProviderTokenEndpoint http://dex:5556/token
OIDCProviderTokenEndpointAuth client_secret_post
OIDCProviderUserInfoEndpoint http://dex:5556/userinfo
OIDCProviderJwksUri http://dex:5556/keys

OIDCScope "openid email profile groups"
OIDCRemoteUserClaim preferred_username
OIDCPassClaimsAs environment
OIDCCryptoPassphrase oauth2-pep-crypto-passphrase-2024
OIDCStateMaxNumberOfCookies 20 

<Location />
    AuthType openid-connect
    Require valid-user

    # Set user headers for the backend application
    RequestHeader set X-User-ID %{OIDC_CLAIM_preferred_username}e
    RequestHeader set X-User-Name %{OIDC_CLAIM_name}e
    RequestHeader set X-User-Email %{OIDC_CLAIM_email}e
    RequestHeader set X-User-Groups %{OIDC_CLAIM_groups}e
    RequestHeader set X-Authenticated "true"

    # Proxy to Flask backend
    ProxyPass http://flask-app:8080/
    ProxyPassReverse http://flask-app:8080/
</Location> 